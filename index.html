<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulir Entry Data Event & Kirim WA</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: #333;
        }
        .container {
            background-color: #ffffff;
            padding: 35px 45px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 600px;
            box-sizing: border-box;
            border: 1px solid #e0e0e0;
        }
        h2 {
            text-align: center;
            color: #007bff;
            margin-bottom: 35px;
            font-weight: 600;
            font-size: 2.2em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.05);
        }
        .form-group {
            margin-bottom: 25px;
        }
        label {
            display: block;
            margin-bottom: 10px;
            color: #555;
            font-weight: 600;
            font-size: 1.05em;
        }
        input[type="text"],
        input[type="date"],
        textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ced4da;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 1em;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            background-color: #fdfdfd;
        }
        input[type="text"]:focus,
        input[type="date"]:focus,
        textarea:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 0.25rem rgba(0, 123, 255, 0.25);
            outline: none;
            background-color: #fff;
        }
        /* input[type="file"] { Ini dihapus karena tidak ada fitur upload foto lagi */
        /* width: 100%; */
        /* padding: 10px 0; */
        /* cursor: pointer; */
        /* } */
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        button {
            background-color: #28a745;
            color: white;
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2em;
            width: 100%;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
            font-weight: 600;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 10px rgba(40, 167, 69, 0.2);
        }
        button:hover {
            background-color: #218838;
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(40, 167, 69, 0.3);
        }
        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(40, 167, 69, 0.2);
        }
        .message {
            margin-top: 30px;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: 500;
            font-size: 1.05em;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            display: none; /* Default hidden */
        }
        .message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .message.info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        small { /* Ini juga bisa dihapus jika tidak ada input type="file" sama sekali */
            color: #6c757d;
            font-size: 0.88em;
            margin-top: 5px;
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Formulir Entry Data Event</h2>
        <form id="eventForm" action="proses_wa.php" method="post">
            <div class="form-group">
                <label for="namaMateriEvent">Nama Materi Event:</label>
                <input type="text" id="namaMateriEvent" name="namaMateriEvent" required placeholder="Contoh: Pemasangan Billboard Promo">
            </div>

            <div class="form-group">
                <label for="brand">Brand:</label>
                <input type="text" id="brand" name="brand" required placeholder="Contoh: Brand XYZ">
            </div>

            <div class="form-group">
                <label for="namaVendor">Nama Vendor:</label>
                <input type="text" id="namaVendor" name="namaVendor" list="vendorList" required placeholder="Ketik atau pilih nama vendor">
                <datalist id="vendorList">
                    </datalist>
                <input type="hidden" id="noTelpVendor" name="noTelpVendor"> </div>

            <div class="form-group">
                <label for="alamatPemasangan">Alamat Pemasangan:</label>
                <textarea id="alamatPemasangan" name="alamatPemasangan" required readonly placeholder="Akan terisi otomatis berdasarkan nama vendor"></textarea>
            </div>

            <div class="form-group">
                <label for="ukuranMateri">Ukuran Materi:</label>
                <input type="text" id="ukuranMateri" name="ukuranMateri" required readonly placeholder="Akan terisi otomatis berdasarkan nama vendor">
            </div>

            <div class="form-group">
                <label for="timpaVisual">Timpa Visual:</label>
                <input type="text" id="timpaVisual" name="timpaVisual" placeholder="Contoh: Ya / Tidak / Materi Baru" required>
            </div>

            <div class="form-group">
                <label for="tglPasang">Tanggal Pasang:</label>
                <input type="date" id="tglPasang" name="tglPasang" required>
            </div>

            <div class="form-group">
                <label for="tglTurun">Tanggal Turun:</label>
                <input type="date" id="tglTurun" name="tglTurun" required>
            </div>

            <button type="submit">Submit Data & Kirim WA</button>
        </form>
        <div id="responseMessage" class="message"></div>
    </div>

    <script>
        // Data Vendor (Dalam aplikasi nyata, ini SANGAT DIREKOMENDASIKAN diambil dari API/Database di backend)
        // Untuk contoh ini, kita simpan statis di frontend
        const vendorData = [
            {
                "namaVendor": "LINTAS MEDIATAMA",
                "alamatPemasangan": "BALIHO Jl. Astana Anyar - 6 m x 4 m BL",
                "ukuranMateri": "Baliho 6x4 m BL",
                "noTelp": "6282128024866" // Contoh nomor WhatsApp yang valid (tanpa +62, 0 di depan, atau spasi)
            },
            {
                "namaVendor": "MITRA PROMO SEDAYA",
                "alamatPemasangan": "BALIHO Jl. Cikawao - 6 m x 4 m FL",
                "ukuranMateri": "Baliho 6x4 m FL",
                "noTelp": "6285156427136" // Ganti dengan nomor yang valid
            },
            {
                "namaVendor": "SUMBER SARANA PROMO",
                "alamatPemasangan": "BALIHO Jl. Gatot Subroto-Burangrang (Depan Bank Niaga) - 6 m x 4 m FL",
                "ukuranMateri": "Baliho 6x4 m FL",
                "noTelp": "6285142156602" // Ganti dengan nomor yang valid
            }
            // Tambahkan data vendor lainnya di sini
        ];

        // Mendapatkan referensi elemen DOM
        const namaVendorInput = document.getElementById('namaVendor');
        const vendorList = document.getElementById('vendorList');
        const alamatPemasanganInput = document.getElementById('alamatPemasangan');
        const ukuranMateriInput = document.getElementById('ukuranMateri');
        const noTelpVendorInput = document.getElementById('noTelpVendor');
        const eventForm = document.getElementById('eventForm');
        const responseMessageDiv = document.getElementById('responseMessage');

        // Fungsi untuk menampilkan pesan respon
        function displayMessage(message, type) {
            responseMessageDiv.textContent = message;
            responseMessageDiv.className = `message ${type}`;
            responseMessageDiv.style.display = 'block';
            setTimeout(() => {
                responseMessageDiv.style.display = 'none';
            }, 7000); // Pesan akan hilang setelah 7 detik
        }

        // Fungsi untuk mengisi datalist dengan nama vendor yang tersedia
        function populateVendorDatalist() {
            vendorList.innerHTML = ''; // Bersihkan opsi lama
            vendorData.forEach(vendor => {
                const option = document.createElement('option');
                option.value = vendor.namaVendor;
                vendorList.appendChild(option);
            });
        }
        populateVendorDatalist(); // Panggil saat halaman dimuat

        // Event listener ketika nilai input namaVendor berubah
        namaVendorInput.addEventListener('change', function() {
            const selectedVendorName = this.value.trim(); // Gunakan .trim() untuk membersihkan spasi
            const foundVendor = vendorData.find(vendor => vendor.namaVendor.trim().toLowerCase() === selectedVendorName.toLowerCase()); // Case-insensitive comparison

            if (foundVendor) {
                alamatPemasanganInput.value = foundVendor.alamatPemasangan;
                ukuranMateriInput.value = foundVendor.ukuranMateri;
                noTelpVendorInput.value = foundVendor.noTelp; // Simpan nomor telepon di input tersembunyi
            } else {
                // Bersihkan bidang jika nama vendor tidak ditemukan atau tidak cocok persis
                alamatPemasanganInput.value = '';
                ukuranMateriInput.value = '';
                noTelpVendorInput.value = '';
                displayMessage('Nama Vendor tidak ditemukan. Pilih dari daftar atau periksa ejaan.', 'error');
            }
        });

        // Event listener untuk submit formulir menggunakan Fetch API
        eventForm.addEventListener('submit', async function(event) {
            event.preventDefault(); // Mencegah reload halaman

            // Validasi di sisi klien sebelum mengirim
            const requiredFields = [
                { id: 'namaMateriEvent', name: 'Nama Materi Event' },
                { id: 'brand', name: 'Brand' },
                { id: 'namaVendor', name: 'Nama Vendor' },
                { id: 'alamatPemasangan', name: 'Alamat Pemasangan' },
                { id: 'ukuranMateri', name: 'Ukuran Materi' },
                { id: 'timpaVisual', name: 'Timpa Visual' },
                { id: 'tglPasang', name: 'Tanggal Pasang' },
                { id: 'tglTurun', name: 'Tanggal Turun' }
            ];

            for (const field of requiredFields) {
                const inputElement = document.getElementById(field.id);
                if (!inputElement.value.trim()) {
                    displayMessage(`${field.name} tidak boleh kosong.`, 'error');
                    inputElement.focus();
                    return;
                }
            }
            
            // Validasi Nomor Telepon Vendor
            if (!noTelpVendorInput.value.trim()) {
                displayMessage('Nomor telepon vendor tidak ditemukan. Mohon pilih vendor yang valid dari daftar.', 'error');
                return;
            }

            // Karena tidak ada upload foto, kita tidak perlu FormData untuk file.
            // Kita bisa pakai URLSearchParams atau objek biasa.
            const formData = new URLSearchParams();
            formData.append('namaMateriEvent', document.getElementById('namaMateriEvent').value.trim());
            formData.append('brand', document.getElementById('brand').value.trim());
            formData.append('namaVendor', document.getElementById('namaVendor').value.trim());
            formData.append('alamatPemasangan', document.getElementById('alamatPemasangan').value.trim());
            formData.append('ukuranMateri', document.getElementById('ukuranMateri').value.trim());
            formData.append('timpaVisual', document.getElementById('timpaVisual').value.trim());
            formData.append('tglPasang', document.getElementById('tglPasang').value.trim());
            formData.append('tglTurun', document.getElementById('tglTurun').value.trim());
            formData.append('noTelpVendor', document.getElementById('noTelpVendor').value.trim());


            try {
                displayMessage('Mengirim data... Mohon tunggu.', 'info');
                
                const response = await fetch('proses_wa.php', {
                    method: 'POST',
                    body: formData, // Menggunakan URLSearchParams
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded' // Penting untuk URLSearchParams
                    }
                });

                // Periksa jika respons HTTP bukan 2xx (misal 500 Internal Server Error)
                if (!response.ok) {
                    const errorText = await response.text(); // Coba ambil teks error dari respon
                    console.error('HTTP Error Response:', errorText);
                    throw new Error(`Server error: ${response.status} - ${response.statusText}. Cek log server untuk detail.`);
                }

                const result = await response.json(); // Menguraikan respon JSON dari server

                if (result.status === 'success') {
                    displayMessage('Sukses: ' + result.message, 'success');
                    eventForm.reset(); // Mengatur ulang formulir setelah sukses
                    // Bersihkan input readonly juga
                    alamatPemasanganInput.value = '';
                    ukuranMateriInput.value = '';
                    noTelpVendorInput.value = '';
                    populateVendorDatalist(); // Isi ulang datalist jika perlu
                } else {
                    displayMessage('Error: ' + result.message + ' (Lihat konsol browser untuk info lebih lanjut)', 'error');
                    console.error('Debug Info dari Server:', result.debug_info);
                }
            } catch (error) {
                console.error('Terjadi kesalahan pada fetch request:', error);
                displayMessage('Terjadi kesalahan saat mengirim data. Silakan coba lagi. Detail: ' + error.message, 'error');
            }
        });
    </script>
</body>
</html>
